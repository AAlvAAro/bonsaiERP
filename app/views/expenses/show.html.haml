- content_for :links do
  %ul.breadcrumbs.span6
    %li
      = link_to "Egresos", expenses_path
    %li
      %i.icon-caret-right
    %li
      = @expense

%header
  - if @expense.has_error
    .allowed-errors
      %h3 Existen errores que debe corregir!
      %ul
        - @expense.error_messages.each do |k, arr|
          - arr.each do |v|
            %li
              %h5.n.devolution-error= I18n.t("allowed_errors.#{v}").html_safe

.row-fluid
  .span7
    %h1
      = @expense
      = @expense.state_tag

      %small
        = link_to @expense.contact do
          %i.icon-user
          = @expense.contact

    %h4.n
      %span.muted Fecha:
      %i= lo @expense.date
      = render_if @expense.due_date do
        = @expense.due_date_tag

  .span5.r
    - if @expense.is_draft?
      = form_for @expense, url: approve_expense_path(@expense), html: {class: 'ib'} do |f|
        = f.submit 'Aprobar', class: 'b btn btn-success'

    - if @expense.can_null?
      = form_for @expense, url: null_expense_path(@expense), html: {class: 'ib'} do |f|
        = f.submit 'Anular', class: 'b btn btn-danger'

    = link_to icon_new_text, new_expense_path, class: 'btn'
    = link_to icon_edit_text, edit_expense_path(@expense.id), class: 'btn' unless @expense.is_nulled? 


.row-fluid
  .moneybox
    %label TOTAL
    %h4
      = ntc @expense.total
      = currency_label @expense.currency

  .moneybox
    %label SALDO
    %h4
      = @expense.balance
      = currency_label @expense.currency

= render 'expenses/tour/devolution'

#tabs
  %ul
    %li
      %a(href="#information" id="tab_info") Información
    %li.payment-li
      %a.payments-tab(href="#payments") Pagos
    -#%li
      %a(href="#inventory") Entregas inventario

  #information
    = render "expenses/items", expense: @expense
  #payments

    %a.btn(id='payment-link' href='javascript:;')
      %i.icon-plus-sign
      Pagar

    -#%a.btn.btn-primary(id='devolution-link' href='javascript:;')
      %i.icon-minus-sign
      Devolver

    #payment-form(style='display: none')
      %h3 Pagar Egreso
      = render 'expenses/payment_form', expense: @expense unless @expense.is_paid?

    #devolution-form(style='display: none')
      -#%h3 Devolución
      -#= render 'expenses/devolution_form', expense: @expense unless @expense.is_draft?

    %h2 Pagos

    %ul.unstyled.listing
      = render partial: 'account_ledgers/income', collection: @expense.payments, as: :ledger

:javascript
  $( function() {
    $('#tabs').tabs()
    // Show hide
    $('#payment-link').click( function() {
      $('#payment-form').show('slow')
      $(this).hide('slow')
    });
    $('#cancel-payment-link').click( function() {
      $('#payment-form').hide('slow')
      $('#payment-link').show('slow')
    });

    // Devolution show hide
    $('#devolution-link').click( function() {
      $('#devolution-form').show('slow')
      $(this).hide('slow')
    });
    $('#cancel-devolution-link').click( function() {
      $('#devolution-form').hide('slow')
      $('#devolution-link').show('slow')
    })
  })
