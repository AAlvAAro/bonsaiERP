-content_for :links do
  %ul.breadcrumps
    %li #{link_list @account_ledger}<span>&gt;</span>
    %li #{link_parent @account_ledger}<span>&gt;</span>

%h1 Nueva transferencia

= simple_form_for @account_ledger, :url => transference_account_ledgers_path do |f|

  = bonsai_form_error(f)
  
  = f.input :account_id, :as => :hidden
  
  .input
    %label De cuenta
    = @account_ledger.account
  = f.input :to_id, :collection => Account.org.money.where("id NOT IN(?)", @account_ledger.account_id), :label => 'A cuenta'
  .clear

  = f.input :amount, :label => "Cantidad #{@account_ledger.account.currency_symbol}", :input_html => {:size => 12, :type => 'decimal', :class => 'r'}, :wrapper_html => {:class => '_30'}

  = f.input :date, :label => 'Fecha', :wrapper_html => {:class => '_20'}

  - disp = @account_ledger.show_exchange_rate? ? 'block' : 'none'

  #al_exchange_rate._50.fl{:style => "display:#{disp}"}
    = f.label :to_exchange_rate, "Tipo de cambio &nbsp;&nbsp;&nbsp;&nbsp;<a href='javascript:' id='cur_rates' class='n'>tipos de cambio</a>".html_safe
    1 #{@account_ledger.account.currency_symbol} = 
    = f.text_field :exchange_rate, :size => 6, :class => 'r'

    - cur = @to_account.present? ? @account_to.currency_name.pluralize : ""
    %span#exchange_rate_cur= cur
    <span class="hint">Puede usar hasta 4 decimales</span>
    - if f.object.errors[:to_exchange_rate].present?
      %span.error= f.object.errors[:to_exchange_rate].join(", ")

  .clear
   
  = f.submit "Transferir"


.rates.bg_white{:style => 'display:none'}
  %h3 Tipos de cambio moneda base "#{currency_name}"
  = render 'currency_rates/active', :currency_rates => CurrencyRate.active

:javascript
  $(function() {
    var accounts = #{Account.to_hash(:name, :currency_id).to_json};
    var currencies = #{Currency.to_hash.to_json};
    window.currencies = currencies;

    $('#account_ledger_to_id').live("change keyup focusout", function() {
      try{
        var currency_id = accounts[$(this).val()].currency_id;
        var label, cur = '';

        if(currency_id != "" && currency_id != "#{@account_ledger.account.currency_id}") {
          cur = currencies[currency_id];
          $('#exchange_rate_cur').html(cur.symbol);
          $('#al_exchange_rate').show().mark();
        }else{
          cur = currencies["#{@account_ledger.account.currency_id}"];
          $('#al_exchange_rate').hide();
        }
      }catch(e) {
        $('#al_exchange_rate').hide();
      }
    });

    $('body').live('new_contact', function(e, resp) {
      $('#account_ledger_contact_id').createSelectOption(resp.id, resp.matchcode);
    });

    $('#cur_rates').click(function() {
      createDialog({title:"Uno", width: 450, html: $('.rates').html(), modal: false });
    });
  });
