.row-fluid
  .span7
    %h1
      %span.n.muted Recibo
      = @ledger
      %small= @ledger.status_tag
      = render_if @ledger.account_contact do
        %small.dark
          = link_to @ledger.account_contact, @ledger.account_contact

  .span5
    = render 'account_ledgers/conciliate_null_form', ledger: @ledger if @ledger.can_conciliate_or_null?
    = link_to account_ledger_path(@ledger.id, format: 'print'), class: 'btn' do
      %i.icon-print
      Imprimir

%p
  = @ledger.operation_tag
  %i= lo @ledger.date.to_date

.row-fluid.account_ledger
  .span6
    .moneybox
      %h5.n
        = ntc @ledger.amount
        = currency_label @ledger.currency

    - unless @ledger.currency === @ledger.account_currency
      = ntc 1.0
      = currency_tag @ledger.currency
      %i.icon-exchange(title='Tipo de cambio' data-toggle='tooltip')
      = ntc @ledger.exchange_rate, precision: 4
      = currency_label

  .span6
    -#%span.reference
      %i.icon-file-alt(title='Referencia' data-toggle='tooltip')
      = @ledger.reference

    .edit-reference
      %a.edit-ledger-reference-link.dark(href='javascript:;' title='Editar referencia' data-toggle='tooltip' data-id='#{@ledger.id}' data-reference='#{@ledger.reference}')
        %i.icon-pencil
      %i.icon-file.muted(data-toggle='tooltip' title="referencia")
      %span.reference= nl2br @ledger.reference
%p
  %h5.n
    %span.account
      %span.muted De cuenta:
      = link_to @ledger.account, @ledger.account, class: 'account_name'
    %span.account-to
      %span.muted A cuenta:
      = link_to @ledger.account_to, @ledger.account_to, class: 'account_to_name'

%p
  = render_if @ledger.updater do
    %i.icon-user.blue(title='Actualizado por' data-toggle='tooltip')
    %span.updater= @ledger.updater
    %span.muted el
    %i.updated_at= l @ledger.updated_at


= render_if @ledger.creator do
  %p
    %i.icon-user(title='Creado por' data-toggle='tooltip')
    = @ledger.creator
    %span.muted el
    %i= l @ledger.created_at

= render_if @ledger.approver do
  %p
    %i.icon-user.text-success(title='Aprovado por' data-toggle='tooltip')
    = @ledger.approver
    %span.muted el
    %i= l @ledger.approver_datetime

= render_if @ledger.nuller do
  %p
    %i.icon-user.text-error(title='Anulado por' data-toggle='tooltip')
    = @ledger.nuller
    %span.muted el
    %i= l @ledger.nuller_datetime

:javascript
  $(function() {
    $('.account_ledger').on('ledger-reference:update', function(event, resp) {
      $('.updater').text(resp.updater);
      $('.updated_at').text(resp.updated_at);
    });
  })
