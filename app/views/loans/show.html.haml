- content_for :links do
  %ul.breadcrumbs
    %li
      = link_to 'Prestamos', loans_path

%h1.ib
  = @loan
  %small= @loan.loan_type_tag


%h4.ib.n
  = link_to @loan.contact, @loan.contact, title: 'Contacto', data: { toggle: 'tooltip' }

.clearfix
%h4.ib.edit-loan
  %a#edit-date.dark.icon-pencil(title='Editar fecha' data-toggle='tooltip' href='javascript:;')
  %span.muted Fecha
  %span.data= l @loan.date
  &nbsp;&nbsp;&nbsp;&nbsp;

%h4.ib.edit-loan
  - unless @loan.is_paid?
    %a#edit-due_date.dark.icon-pencil(title='Editar fecha de vencimiento' data-toggle='tooltip' href='javascript:;')
    %span.muted Vence el
    = @loan.due_date_color

- unless currency == @loan.currency
  %p
    Tipo de cambio 1
    = currency_label currency
    \=
    = ntc@loan.exchange_rate, precision: 4
    = currency_label @loan.currency

.row-fluid
  .span6
    .moneybox
      %label TOTAL
      %h4.n
        = ntc @loan.total
        = currency_label @loan.currency
    .moneybox
      %label SALDO
      %h4.n
        = ntc @loan.amount
        = currency_label @loan.currency
    .moneybox
      %label INTERESES
      %h4.n
        = ntc @loan.interests
        = currency_label @loan.currency

  .span6
    .edit-loan
      %a#edit-description.dark.icon-pencil(title='Editar descripción' data-toggle='tooltip' href='javascript:;')
      %i.icon-file.muted(title='Descripción' data-toggle='tooltip')
      %span.data= @loan.description


:javascript
  $(function() {
    new App.LoanEdit(#{@loan.id})
  })

.row-fluid
  .span6
    %h3.n Pagos y devoluciones

    .center

      = @loan.payment_link

    #payment-form.form-container(ng-controller='DynamicController' dynamic='htmlContent')

    %ul.unstyled.listing
      = render partial: 'account_ledgers/movement', collection: present(@loan.payments_devolutions), as: :ledger, locals: { current_account_id: @loan.id }

  .span6
    %h3.n Intereses
    .center
      = @loan.interest_link

    #interest-form.form-container(ng-controller='DynamicController' dynamic='htmlContent')

    %ul.unstyled.listing
      = render partial: 'account_ledgers/movement', collection: present(@loan.interest_ledgers), locals: { current_account_id: @loan.id }, as: :ledger
